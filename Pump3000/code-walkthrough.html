<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Code Walkthrough &mdash; Cavro XP3000 GUI 1.0 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="top" title="Cavro XP3000 GUI 1.0 documentation" href="index.html" />
    <link rel="next" title="License" href="license.html" />
    <link rel="prev" title="Pump Commands" href="pump-commands.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="license.html" title="License"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="pump-commands.html" title="Pump Commands"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Cavro XP3000 GUI 1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="code-walkthrough">
<h1>Code Walkthrough<a class="headerlink" href="#code-walkthrough" title="Permalink to this headline">¶</a></h1>
<p>This purpose of this section is to give you the basic information about the GUI
implementation with the use of Python and PySide.
For those who aren&#8217;t familiar coding in Python or haven&#8217;t heard of GUI development using PySide
and Qt may find the links below useful:</p>
<p>-Official Python website: <a class="reference external" href="https://www.python.org/">https://www.python.org/</a></p>
<p>-PySide: Python Bindings for Qt: <a class="reference external" href="http://qt-project.org/wiki/pyside">http://qt-project.org/wiki/pyside</a></p>
<div class="section" id="full-python-code">
<h2>Full Python Code<a class="headerlink" href="#full-python-code" title="Permalink to this headline">¶</a></h2>
<div class="section" id="script-1-pump-model-py">
<h3>Script #1: pump_model.py<a class="headerlink" href="#script-1-pump-model-py" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Tue Jun 3 19:49:03 EEST 2014, nickkouk</span>

<span class="sd">&quot;&quot;&quot; </span>

<span class="sd">This is the pump model for the Cavro XP3000 Pump series.</span>

<span class="sd">It is designed to implement all the basic controls of the pump independent of</span>
<span class="sd">the way the user interacts with it (GUI, CLI, etc).</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="c"># Imports </span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span>
<span class="nb">__import__</span><span class="p">(</span><span class="s">&#39;serial.urlhandler.protocol_loop&#39;</span><span class="p">)</span> <span class="c"># Special import, needed for py2exe</span>
<span class="kn">import</span> <span class="nn">serial</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">exceptions_module</span> <span class="kn">import</span> <span class="n">BusyPump</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">signal</span>
<span class="kn">import</span> <span class="nn">Queue</span>

<span class="k">class</span> <span class="nc">Pump</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addr</span><span class="p">,</span> <span class="n">com</span> <span class="o">=</span> <span class="s">&#39;serial&#39;</span><span class="p">):</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">addr</span> <span class="o">=</span> <span class="s">&#39;/</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span><span class="n">addr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">term</span> <span class="o">=</span> <span class="s">&#39;R</span><span class="se">\r</span><span class="s">&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">com</span> <span class="o">=</span> <span class="n">com</span>

        <span class="c"># Control Related properties</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">history</span> <span class="o">=</span> <span class="p">[</span> <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interval</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeout_time</span> <span class="o">=</span> <span class="mf">0.2</span> 

        <span class="bp">self</span><span class="o">.</span><span class="n">stop_flag</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">signal</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGINT</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_thread</span><span class="p">)</span>


        <span class="c"># sending mechanism</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exc_mode</span> <span class="o">=</span> <span class="s">&#39;interactive&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">questions_out</span> <span class="o">=</span> <span class="n">Queue</span><span class="o">.</span><span class="n">Queue</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">answers_ret</span> <span class="o">=</span> <span class="n">Queue</span><span class="o">.</span><span class="n">Queue</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">answers_lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_sema</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Semaphore</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c"># Dictionary for holding the pump properties</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;absolute_pos&quot;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>\
                <span class="s">&quot;top_vel&quot;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>\
                <span class="s">&quot;cutoff_vel&quot;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>\
                <span class="s">&quot;actual_pos&quot;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span> \
                <span class="s">&quot;starting_vel&quot;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>\
                <span class="s">&quot;backlash_steps&quot;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>\
                <span class="s">&quot;fluid_sensor&quot;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>\
                <span class="s">&quot;buffer_status&quot;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>\
                <span class="s">&quot;version&quot;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>\
                <span class="s">&quot;checksum&quot;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">}</span>


        <span class="c"># Hold local properties</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">own_status</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;plung_pos_mine&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>\
                <span class="s">&quot;valve_pos&quot;</span><span class="p">:</span> <span class="s">&#39;0&#39;</span><span class="p">,</span>\
                <span class="s">&quot;syringe_size&quot;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>\
                <span class="s">&quot;steps_tot&quot;</span><span class="p">:</span> <span class="mi">3000</span><span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">correspondance</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;speed&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;S&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">40</span><span class="p">],</span>\
                <span class="s">&quot;backlash&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;K&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">31</span><span class="p">],</span>\
                <span class="s">&quot;slope&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;L&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">],</span>\
                <span class="s">&quot;start_velocity&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;v&#39;</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">1000</span><span class="p">],</span>\
                <span class="s">&quot;top_velocity&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5800</span><span class="p">],</span>\
                <span class="s">&quot;cutoff_velocity&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">2700</span><span class="p">],</span>\
                <span class="s">&quot;cutoff_velocity_steps&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;C&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">25</span><span class="p">],</span>\
                <span class="p">}</span>


        <span class="c"># Start the delivery thread</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deliveryThread</span> <span class="o">=</span> <span class="n">delivery_thread</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deliveryThread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="k">print</span> <span class="s">&quot;THREAD STARTED&quot;</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">connect_new</span><span class="p">(</span><span class="n">port_name</span> <span class="o">=</span> <span class="s">&#39;loop://&#39;</span><span class="p">)</span>

    <span class="c"># New serial connection</span>
    <span class="k">def</span> <span class="nf">connect_new</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">port_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Function for configuring a new serial connection.&quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ser</span> <span class="o">=</span> <span class="n">serial</span><span class="o">.</span><span class="n">Serial</span><span class="p">(</span><span class="n">port</span> <span class="o">=</span> <span class="n">port_name</span><span class="p">,</span>\
                    <span class="n">baudrate</span> <span class="o">=</span> <span class="mi">9600</span><span class="p">,</span>\
                    <span class="n">parity</span> <span class="o">=</span> <span class="s">&#39;N&#39;</span><span class="p">,</span>\
                    <span class="n">stopbits</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>\
                    <span class="n">bytesize</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>\
                    <span class="n">timeout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeout_time</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">serial</span><span class="o">.</span><span class="n">SerialException</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ser</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s">&#39;serial.urlhandler.protocol_loop&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">Serial</span><span class="p">(</span><span class="s">&#39;loop://&#39;</span><span class="p">,</span>\
                <span class="n">timeout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeout_time</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">initialize_pump</span><span class="p">()</span>


    <span class="c"># Initialization Phase</span>
    <span class="k">def</span> <span class="nf">initialize_pump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output</span> <span class="o">=</span> <span class="s">&#39;right&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize (the newly) configured pump&quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">open</span><span class="p">()</span>
            <span class="k">print</span> <span class="s">&quot;Opened the Serial port {} successfully&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">port</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="c"># These commands should be sent when the pump first gets set</span>
        <span class="k">if</span> <span class="n">output</span> <span class="o">==</span> <span class="s">&#39;right&#39;</span><span class="p">:</span>
            <span class="n">commands</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;S10&#39;</span><span class="p">,</span> <span class="s">&#39;Z&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">commands</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Y&#39;</span><span class="p">,</span> <span class="s">&#39;S10&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">command</span> <span class="ow">in</span> <span class="n">commands</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">send_Command</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

        <span class="c"># Actions after every initialization</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">history</span> <span class="o">=</span> <span class="p">[</span> <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_values</span><span class="p">(</span><span class="n">initialize</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>

    <span class="c"># Valve Position</span>
    <span class="k">def</span> <span class="nf">valve_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">position</span> <span class="o">==</span> <span class="s">&quot;out&quot;</span><span class="p">:</span>
            <span class="n">answer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_Command</span><span class="p">(</span><span class="s">&#39;O&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">own_status</span><span class="p">[</span><span class="s">&quot;valve_pos&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;O&#39;</span>
        <span class="k">elif</span> <span class="n">position</span> <span class="o">==</span> <span class="s">&quot;in&quot;</span><span class="p">:</span>
            <span class="n">answer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_Command</span><span class="p">(</span><span class="s">&#39;I&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">own_status</span><span class="p">[</span><span class="s">&quot;valve_pos&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;I&#39;</span>
        <span class="k">elif</span> <span class="n">position</span> <span class="o">==</span> <span class="s">&quot;bypass&quot;</span><span class="p">:</span>
            <span class="n">answer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_Command</span><span class="p">(</span><span class="s">&#39;B&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">own_status</span><span class="p">[</span><span class="s">&quot;valve_pos&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;B&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;NO SUCH VALUE for position available&quot;</span>
        <span class="k">return</span> <span class="n">answer</span>

    <span class="c"># Plunger Functions</span>
    <span class="k">def</span> <span class="nf">property_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a_property</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="c"># Checking the validity of the command</span>
        <span class="n">min_value</span><span class="p">,</span> <span class="n">max_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">correspondance</span><span class="p">[</span><span class="n">a_property</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">min_value</span> <span class="ow">and</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">max_value</span><span class="p">:</span>
            <span class="c"># Sending the Command to the queue</span>
            <span class="n">command</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">correspondance</span><span class="p">[</span><span class="n">a_property</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">value</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span><span class="n">value</span>
            <span class="k">print</span> <span class="s">&quot;SENDING THE COMMNAND&quot;</span>
            <span class="n">return_stat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_Command</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>\
                <span class="n">command</span> <span class="o">+</span> <span class="n">value</span><span class="p">),</span> <span class="mi">10</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">return_stat</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&quot;OUT OF BOUNDS&quot;</span>
                        
    <span class="k">def</span> <span class="nf">volume_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">direction</span> <span class="o">=</span> <span class="s">&#39;P&#39;</span><span class="p">,</span> <span class="n">vol</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">special</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This is the volume command.</span>

<span class="sd">        The volume_command function first decides if it can </span>
<span class="sd">        deliver the needed volume, </span>
<span class="sd">        then if the volume given is a valid one,</span>
<span class="sd">        calls the move_plunger method with the needed arguments</span>
<span class="sd">        to deliver the volume.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">valid</span> <span class="o">=</span> <span class="s">&quot;True&quot;</span>
        <span class="n">status</span> <span class="o">=</span> <span class="s">&quot;Done&quot;</span>

        <span class="k">if</span> <span class="n">special</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">special</span> <span class="o">==</span> <span class="s">&#39;push_all&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">send_Command</span><span class="p">(</span><span class="s">&#39;A0&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">own_status</span><span class="p">[</span><span class="s">&quot;plung_pos_mine&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">send_Command</span><span class="p">(</span><span class="s">&#39;A3000&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">own_status</span><span class="p">[</span><span class="s">&quot;plung_pos_mine&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3000</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">vol</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
                <span class="k">return</span> <span class="p">(</span><span class="bp">False</span><span class="p">,</span> <span class="s">&quot;Please enter a numerical value&quot;</span><span class="p">)</span>

            <span class="n">vol</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">vol</span><span class="p">)</span>
            <span class="n">steps</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">own_status</span><span class="p">[</span><span class="s">&quot;steps_tot&quot;</span><span class="p">]</span> <span class="o">/</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">own_status</span><span class="p">[</span><span class="s">&quot;syringe_size&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">vol</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">direction</span> <span class="o">==</span> <span class="s">&#39;D&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">own_status</span><span class="p">[</span><span class="s">&quot;plung_pos_mine&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">steps</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">valid</span> <span class="o">=</span> <span class="bp">False</span>
                    <span class="n">status</span> <span class="o">=</span> <span class="s">&quot;Not a valid Value&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">own_status</span><span class="p">[</span><span class="s">&quot;plung_pos_mine&quot;</span><span class="p">]</span> <span class="o">-=</span> <span class="n">steps</span>
                    <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_Command</span><span class="p">(</span><span class="n">direction</span> <span class="o">+</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span><span class="n">steps</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">own_status</span><span class="p">[</span><span class="s">&quot;plung_pos_mine&quot;</span><span class="p">]</span> <span class="o">+</span>\
                        <span class="n">steps</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">own_status</span><span class="p">[</span><span class="s">&quot;steps_tot&quot;</span><span class="p">]:</span>
                    <span class="n">valid</span> <span class="o">=</span> <span class="bp">False</span>
                    <span class="n">status</span> <span class="o">=</span> <span class="s">&quot;Not a valid Value&quot;</span>
                <span class="k">else</span><span class="p">:</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">own_status</span><span class="p">[</span><span class="s">&quot;plung_pos_mine&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">steps</span>
                    <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_Command</span><span class="p">(</span><span class="n">direction</span> <span class="o">+</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span><span class="n">steps</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">valid</span><span class="p">,</span> <span class="n">status</span><span class="p">)</span>
            
    <span class="c"># Pump related Settings update method</span>
    <span class="k">def</span> <span class="nf">update_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">initialize</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This is the parameters update method.</span>

<span class="sd">        The purpose of this function is to constantly update the settings </span>
<span class="sd">        related to the pump, should be run by a thread periodically</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_sema</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
        <span class="k">print</span> <span class="s">&quot;ENTERED THE SEMAPHORE&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span>\
                <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">actual_update_method</span><span class="p">,</span>\
                <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">initialize</span><span class="p">,))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">actual_update_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">initialize</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c"># reading info mechanism</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s">&quot;absolute_pos&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_Command</span><span class="p">(</span><span class="s">&#39;?&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s">&quot;actual_pos&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_Command</span><span class="p">(</span><span class="s">&#39;?4&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s">&quot;starting_vel&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_Command</span><span class="p">(</span><span class="s">&#39;?1&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s">&quot;top_vel&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_Command</span><span class="p">(</span><span class="s">&#39;?2&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s">&quot;cutoff_vel&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_Command</span><span class="p">(</span><span class="s">&#39;?3&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s">&quot;backlash_steps&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_Command</span><span class="p">(</span><span class="s">&#39;?12&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s">&quot;fluid_sensor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_Command</span><span class="p">(</span><span class="s">&#39;?22&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s">&quot;buffer_status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_Command</span><span class="p">(</span><span class="s">&#39;?F&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s">&quot;version&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_Command</span><span class="p">(</span><span class="s">&#39;?&amp;&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s">&quot;checksum&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_Command</span><span class="p">(</span><span class="s">&#39;?#&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">:]</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;In actual_update_method,</span><span class="se">\n</span><span class="s">{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">abs_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s">&quot;absolute_pos&quot;</span><span class="p">][:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="nb">int</span><span class="p">(</span><span class="n">abs_pos</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">3000</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">own_status</span><span class="p">[</span><span class="s">&quot;plung_pos_mine&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">abs_pos</span><span class="p">)</span>
                <span class="k">print</span> <span class="s">&quot;Plunger Position is set: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">own_status</span><span class="p">[</span><span class="s">&quot;plung_pos_mine&quot;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&quot;Out of range value reported by pump!&quot;</span>
                <span class="k">pass</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_sema</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
        <span class="k">print</span> <span class="s">&quot;EXITED THE SEMAPHORE&quot;</span>
    <span class="c"># Supplementary Functions</span>
    <span class="k">def</span> <span class="nf">terminate_execution</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_Command</span><span class="p">(</span><span class="s">&#39;T&#39;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_values</span><span class="p">()</span> <span class="c"># So that the plunger position may refresh itself</span>

    <span class="k">def</span> <span class="nf">stop_thread</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">signum</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">fname</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">&quot;C-c caught!!&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_flag</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">change_mode</span><span class="p">(</span><span class="n">mode</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Function for changing the mode the commands are executed.</span>

<span class="sd">        Must be invoked at the end of the editor commands&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exc_mode</span> <span class="o">=</span> <span class="n">mode</span>
        <span class="k">print</span> <span class="s">&quot;the mode has changed to {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exc_mode</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">send_Command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">,</span> <span class="n">bits_to_read</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Major mechanism for sending the commands to the pump.</span>

<span class="sd">        Stores the coming commands on a queue from which they are sent to the pump.</span>
<span class="sd">        Decides upon waiting for the answer if on interactive mode, or not.</span>
<span class="sd">        Finally returns the answer to the calling function</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">full_command</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addr</span> <span class="o">+</span> <span class="n">command</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">term</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">answers_lock</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">questions_out</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">full_command</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">full_command</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exc_mode</span> <span class="o">==</span> <span class="s">&#39;interactive&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">bits_to_read</span><span class="p">:</span>
                    <span class="n">answer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">answers_ret</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">timeout</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">answers_ret</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">timeout</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">)</span>
                    <span class="k">print</span> <span class="s">&quot;NO NEED TO READ&quot;</span>

        <span class="k">except</span> <span class="n">Queue</span><span class="o">.</span><span class="n">Empty</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;Answer Queue is empty!!&quot;</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;ERROR in SEND_COMMAND:&quot;</span>
            <span class="k">print</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stop_thread</span><span class="p">()</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">answers_lock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exc_mode</span> <span class="o">==</span> <span class="s">&#39;interactive&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="s">&#39;answer&#39;</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">():</span>
                    <span class="k">return</span> <span class="n">answer</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="mi">0</span>

<span class="k">class</span> <span class="nc">delivery_thread</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class for sending the queued commands to the pump.</span>

<span class="sd">    When initialized, the instance of the class inherits the pump instance as</span>
<span class="sd">    well as the send &amp; return queues.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pump</span><span class="p">):</span>
        <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pump</span> <span class="o">=</span> <span class="n">pump</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">forSending</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pump</span><span class="o">.</span><span class="n">questions_out</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">forGivingBack</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pump</span><span class="o">.</span><span class="n">answers_ret</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">pump</span><span class="o">.</span><span class="n">stop_flag</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">com_to_send</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forSending</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">timeout</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pump</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">com_to_send</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
                <span class="n">answer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pump</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span>
                <span class="n">done</span><span class="p">,</span> <span class="n">answer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_command</span><span class="p">(</span><span class="n">com_to_send</span><span class="p">,</span> <span class="n">answer</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pump</span><span class="o">.</span><span class="n">exc_mode</span> <span class="o">==</span> <span class="s">&#39;interactive&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">forGivingBack</span><span class="o">.</span><span class="n">put</span><span class="p">((</span><span class="n">answer</span><span class="p">,</span> <span class="n">done</span><span class="p">))</span>
            <span class="k">except</span> <span class="n">Queue</span><span class="o">.</span><span class="n">Empty</span><span class="p">:</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">print</span> <span class="s">&quot;Questions Queue is empty&quot;</span>

    <span class="k">def</span> <span class="nf">push_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">QA</span><span class="p">):</span>
        <span class="n">com_to_send</span> <span class="o">=</span> <span class="n">QA</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">answer</span> <span class="o">=</span> <span class="n">QA</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pump</span><span class="o">.</span><span class="n">exc_mode</span> <span class="o">==</span> <span class="s">&#39;editor&#39;</span><span class="p">:</span>
            <span class="c"># editor Mode</span>
            <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">pump_busy</span><span class="p">(</span><span class="n">com_to_send</span><span class="p">,</span> <span class="n">answer</span><span class="p">):</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">pump</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">com_to_send</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span> 
                <span class="n">answer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pump</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span>
            <span class="n">done</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># interactive Mode</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pump_busy</span><span class="p">(</span><span class="n">com_to_send</span><span class="p">,</span> <span class="n">answer</span><span class="p">):</span>
                <span class="n">done</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">done</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">print</span> <span class="s">&quot;</span><span class="se">\n\n</span><span class="s">done = {0}</span><span class="se">\n</span><span class="s">mode = {1}</span><span class="se">\n</span><span class="s">question = {2}</span><span class="se">\n</span><span class="s">answer = {3}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">done</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pump</span><span class="o">.</span><span class="n">exc_mode</span><span class="p">,</span> <span class="n">com_to_send</span><span class="p">,</span> <span class="n">answer</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">done</span><span class="p">,</span> <span class="n">answer</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">pump_busy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">QA</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Determines if the pump is busy for the specific command to send.</span>

<span class="sd">        Accepts as input the command to the pump the answer returned and returns</span>
<span class="sd">        to the caller if the command has been accepted by the pump</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">question</span> <span class="o">=</span> <span class="n">QA</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">answer</span> <span class="o">=</span> <span class="n">QA</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">print</span> <span class="s">&#39;The answer is {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">answer</span><span class="p">)</span>
        <span class="k">if</span> <span class="s">&#39;o&#39;</span> <span class="ow">in</span> <span class="n">answer</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
</pre></div>
</div>
</div>
<div class="section" id="script-2-pump3000-py">
<h3>Script #2: Pump3000.py<a class="headerlink" href="#script-2-pump3000-py" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#!/usr/bin/env python</span>
<span class="c"># Mon May 26 23:48:35 EEST 2014, nickkouk</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">===============================================================================</span>
<span class="sd">                                About</span>
<span class="sd">===============================================================================</span>

<span class="sd">Pump3000 was developed by Nikos Koukis (nickkouk@gmail.com). Its main purpose is </span>
<span class="sd">to offer a simple Graphical User Interface for communication with the Cavro XP3000</span>
<span class="sd">pumps. It was created primarily for scientific usage for the &quot;Systems Biology and</span>
<span class="sd">Bioengineering&quot; Laboratory of the National Technical University of Athens</span>
<span class="sd">(NTUA).</span>

<span class="sd">For further assistance see the documentation on http://https://github.com/bergercookie</span>

<span class="sd">For bug reports, and suggestions either raise an issue on the Github page of the</span>
<span class="sd">project, or contact me in person (nickouk@gmail.com)</span>

<span class="sd">===============================================================================</span>
<span class="sd">                        Redistribution Policy</span>
<span class="sd">===============================================================================</span>

<span class="sd">This is a free software, licensed under LGPLv2. It can be redistributed and</span>
<span class="sd">modified as long as the freedom to use is passed on to the recipients. For complete</span>
<span class="sd">policy of terms, consult a version of the license, either on the documentation page:</span>
<span class="sd">https://github.com/bergercookie/Cavro-Pump-XP3000-GUI/blob/master/LICENSE or on</span>
<span class="sd">the GNU page: https://www.gnu.org/licenses/lgpl-2.1.html</span>

<span class="sd">===============================================================================</span>
<span class="sd">            Python Implementation for the Cavro XP3000 GUI.</span>
<span class="sd">                             Pump3000</span>
<span class="sd">===============================================================================</span>

<span class="sd">The GUI is designed with regards to the MVC (Model View Controller)</span>
<span class="sd">UI architectural pattern. Inside this module the View - Controller behaviors</span>
<span class="sd">are implemented while the Model behavior is implemented in the imported module: pump_model.py</span>


<span class="sd">&quot;&quot;&quot;</span>


<span class="c"># proper division for python 2.7</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span>

<span class="c"># Usual importing stuff for PySide</span>
<span class="kn">from</span> <span class="nn">PySide.QtGui</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">PySide.QtCore</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c"># Module imports</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="kn">import</span> <span class="nn">pump_model</span>
<span class="kn">from</span> <span class="nn">classes_used</span> <span class="kn">import</span> <span class="n">HistoryDialog</span><span class="p">,</span>\
        <span class="n">ReportsDialog</span><span class="p">,</span>\
        <span class="n">NewDevDialog</span><span class="p">,</span>\
        <span class="n">SyringePickDialog</span><span class="p">,</span>\
        <span class="n">ParametersChange</span><span class="p">,</span>\
        <span class="n">AboutDialog</span><span class="p">,</span>\
        <span class="n">AboutDialog2</span>

<span class="c"># Qt-Designer compiled python code</span>
<span class="kn">import</span> <span class="nn">python_gui</span>
<span class="kn">import</span> <span class="nn">python_settings</span>
<span class="kn">import</span> <span class="nn">history_settings</span>
<span class="kn">import</span> <span class="nn">device_configuration</span>


<span class="k">class</span> <span class="nc">MainWindow</span><span class="p">(</span><span class="n">QMainWindow</span><span class="p">,</span> <span class="n">python_gui</span><span class="o">.</span><span class="n">Ui_MainWindow</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MainWindow</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setupUi</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__appname__</span> <span class="o">=</span> <span class="s">&quot;Pump3000&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__appname__</span><span class="p">)</span>

        <span class="c"># Initialize a pump instance</span>
        <span class="c"># You define how to start the pump</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pump</span> <span class="o">=</span> <span class="n">pump_model</span><span class="o">.</span><span class="n">Pump</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s">&#39;serial&#39;</span><span class="p">)</span>

        <span class="c"># MainWindow related parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">quick_action</span> <span class="o">=</span> <span class="s">&#39;push_all&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">editors_open</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lcdNumber</span><span class="o">.</span><span class="n">display</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

        <span class="c">#open fd</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">open_files</span> <span class="o">=</span> <span class="p">[</span> <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_time</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modified_time</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

        <span class="c"># Setting tabs titles</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tabWidget</span><span class="o">.</span><span class="n">setTabText</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">&#39;Controls&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tabWidget</span><span class="o">.</span><span class="n">setTabText</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&#39;Editor - {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">editors_open</span><span class="p">))</span>

        <span class="c"># Reverting any changes not shown in the Window</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">revertQtimer</span> <span class="o">=</span> <span class="n">QTimer</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">revertQtimer</span><span class="o">.</span><span class="n">setInterval</span><span class="p">(</span><span class="mi">60000</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">revertQtimer</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

        <span class="c"># Initialize the port configuration</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">newDev</span><span class="p">()</span>

        <span class="c"># Set up a timer for periodical refresh of the pump parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_status</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refreshQtimer</span> <span class="o">=</span> <span class="n">QTimer</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refreshQtimer</span><span class="o">.</span><span class="n">setInterval</span><span class="p">(</span><span class="mi">60000</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refreshQtimer</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

        <span class="c"># Other dialogs instances</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reports_window</span> <span class="o">=</span> <span class="n">ReportsDialog</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pump</span><span class="p">,</span>\
                <span class="bp">self</span><span class="p">,</span>\
                <span class="n">parent</span> <span class="o">=</span> <span class="bp">None</span><span class="p">)</span>

        <span class="c"># saving the previous status of commands to revert in case pump busy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prev_plung_pos</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prev_valve_btn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_btn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">valve_correspond</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;out&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_btn</span><span class="p">,</span>\
                <span class="s">&quot;in&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_btn</span><span class="p">,</span>\
                <span class="s">&quot;bypass&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">bypass_btn</span>
                <span class="p">}</span>

        <span class="c"># Valve Signals</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_btn</span><span class="p">,</span>\
                <span class="n">SIGNAL</span><span class="p">(</span><span class="s">&quot;clicked()&quot;</span><span class="p">),</span>\
                <span class="bp">self</span><span class="o">.</span><span class="n">valve_status</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_btn</span><span class="p">,</span>\
                <span class="n">SIGNAL</span><span class="p">(</span><span class="s">&quot;clicked()&quot;</span><span class="p">),</span>\
                <span class="bp">self</span><span class="o">.</span><span class="n">valve_status</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bypass_btn</span><span class="p">,</span>\
                <span class="n">SIGNAL</span><span class="p">(</span><span class="s">&quot;clicked()&quot;</span><span class="p">),</span>\
                <span class="bp">self</span><span class="o">.</span><span class="n">valve_status</span><span class="p">)</span>

        <span class="c"># Plunger Movement</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">speed_slider</span><span class="p">,</span>\
                <span class="n">SIGNAL</span><span class="p">(</span><span class="s">&quot;sliderReleased()&quot;</span><span class="p">),</span>\
                <span class="bp">self</span><span class="o">.</span><span class="n">speed_control</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">speed_slider</span><span class="p">,</span>\
                <span class="n">SIGNAL</span><span class="p">(</span><span class="s">&quot;valueChanged(int)&quot;</span><span class="p">),</span>\
                <span class="bp">self</span><span class="o">.</span><span class="n">lcd_display</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">volume_button</span><span class="p">,</span>\
                <span class="n">SIGNAL</span><span class="p">(</span><span class="s">&quot;clicked()&quot;</span><span class="p">),</span>\
                <span class="bp">self</span><span class="o">.</span><span class="n">volume_control</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">volume_prompt</span><span class="p">,</span>\
                <span class="n">SIGNAL</span><span class="p">(</span><span class="s">&quot;textEdited(QString)&quot;</span><span class="p">),</span>\
                <span class="bp">self</span><span class="o">.</span><span class="n">enable_button</span><span class="p">)</span>

        <span class="c"># Quick CommandsComboBox</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">quick_combobox</span><span class="p">,</span>\
                <span class="n">SIGNAL</span><span class="p">(</span><span class="s">&quot;currentIndexChanged(int)&quot;</span><span class="p">),</span>\
                <span class="bp">self</span><span class="o">.</span><span class="n">quick_combobox_fun</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">address_combobox</span><span class="p">,</span>\
                <span class="n">SIGNAL</span><span class="p">(</span><span class="s">&quot;currentIndexChanged(int)&quot;</span><span class="p">),</span>\
                <span class="bp">self</span><span class="o">.</span><span class="n">set_address</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">make_it_so</span><span class="p">,</span>\
                <span class="n">SIGNAL</span><span class="p">(</span><span class="s">&quot;clicked()&quot;</span><span class="p">),</span>\
                <span class="bp">self</span><span class="o">.</span><span class="n">make_it_so_function</span><span class="p">)</span>

        <span class="c"># Other Dialogs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actionReports</span><span class="p">,</span>\
                <span class="n">SIGNAL</span><span class="p">(</span><span class="s">&quot;triggered()&quot;</span><span class="p">),</span>\
                <span class="bp">self</span><span class="o">.</span><span class="n">reports_window_open</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actionHistory</span><span class="p">,</span>\
                <span class="n">SIGNAL</span><span class="p">(</span><span class="s">&quot;triggered()&quot;</span><span class="p">),</span>\
                <span class="bp">self</span><span class="o">.</span><span class="n">history_window_open</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actionNew_Device</span><span class="p">,</span>\
                <span class="n">SIGNAL</span><span class="p">(</span><span class="s">&quot;triggered()&quot;</span><span class="p">),</span>\
                <span class="bp">self</span><span class="o">.</span><span class="n">newDev</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actionSyringe_Size</span><span class="p">,</span>\
                <span class="n">SIGNAL</span><span class="p">(</span><span class="s">&quot;triggered()&quot;</span><span class="p">),</span>\
                <span class="bp">self</span><span class="o">.</span><span class="n">newSyringe</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actionPump_Parameters</span><span class="p">,</span>\
                <span class="n">SIGNAL</span><span class="p">(</span><span class="s">&quot;triggered()&quot;</span><span class="p">),</span>\
                <span class="bp">self</span><span class="o">.</span><span class="n">parameters_change_open</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actionLeft_Valve</span><span class="p">,</span>\
                <span class="n">SIGNAL</span><span class="p">(</span><span class="s">&quot;triggered()&quot;</span><span class="p">),</span>\
                <span class="bp">self</span><span class="o">.</span><span class="n">init_valve_left</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actionRight_Valve</span><span class="p">,</span>\
                <span class="n">SIGNAL</span><span class="p">(</span><span class="s">&quot;triggered()&quot;</span><span class="p">),</span>\
                <span class="bp">self</span><span class="o">.</span><span class="n">init_valve_right</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actionAbout</span><span class="p">,</span>\
                <span class="n">SIGNAL</span><span class="p">(</span><span class="s">&quot;triggered()&quot;</span><span class="p">),</span>\
                <span class="bp">self</span><span class="o">.</span><span class="n">about_software</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actionLicense</span><span class="p">,</span>\
                <span class="n">SIGNAL</span><span class="p">(</span><span class="s">&quot;triggered()&quot;</span><span class="p">),</span>\
                <span class="bp">self</span><span class="o">.</span><span class="n">about_license</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actionCommands</span><span class="p">,</span>\
                <span class="n">SIGNAL</span><span class="p">(</span><span class="s">&quot;triggered()&quot;</span><span class="p">),</span>\
                <span class="bp">self</span><span class="o">.</span><span class="n">editor_help</span><span class="p">)</span>

        <span class="c"># QTimer events</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">refreshQtimer</span><span class="p">,</span>\
                <span class="n">SIGNAL</span><span class="p">(</span><span class="s">&quot;timeout()&quot;</span><span class="p">),</span>\
                <span class="bp">self</span><span class="o">.</span><span class="n">update_pump_values</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">revertQtimer</span><span class="p">,</span>\
                <span class="n">SIGNAL</span><span class="p">(</span><span class="s">&quot;timeout()&quot;</span><span class="p">),</span>\
                <span class="bp">self</span><span class="o">.</span><span class="n">revert_GUI_values</span><span class="p">)</span>

        <span class="c"># Editor related action buttons</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actionSave</span><span class="p">,</span>\
                <span class="n">SIGNAL</span><span class="p">(</span><span class="s">&quot;triggered()&quot;</span><span class="p">),</span>\
                <span class="bp">self</span><span class="o">.</span><span class="n">save_btn</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actionSaveAs</span><span class="p">,</span>\
                <span class="n">SIGNAL</span><span class="p">(</span><span class="s">&quot;triggered()&quot;</span><span class="p">),</span>\
                <span class="bp">self</span><span class="o">.</span><span class="n">saveAs_btn</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actionOpen</span><span class="p">,</span>\
                <span class="n">SIGNAL</span><span class="p">(</span><span class="s">&quot;triggered()&quot;</span><span class="p">),</span>\
                <span class="bp">self</span><span class="o">.</span><span class="n">open_btn</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">textEdit</span><span class="p">,</span>\
                <span class="n">SIGNAL</span><span class="p">(</span><span class="s">&quot;textChanged()&quot;</span><span class="p">),</span>\
                <span class="bp">self</span><span class="o">.</span><span class="n">update_modify_time</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">run_script_btn</span><span class="p">,</span>\
                <span class="n">SIGNAL</span><span class="p">(</span><span class="s">&quot;clicked()&quot;</span><span class="p">),</span>\
                <span class="bp">self</span><span class="o">.</span><span class="n">run_script</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clear_editor_btn</span><span class="p">,</span>\
                <span class="n">SIGNAL</span><span class="p">(</span><span class="s">&quot;clicked()&quot;</span><span class="p">),</span>\
                <span class="bp">self</span><span class="o">.</span><span class="n">clear_editor</span><span class="p">)</span>

        <span class="c"># Visualizing the pump </span>
        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;win&#39;</span><span class="p">:</span> <span class="c">#Running on windows, most probably executable</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pixmap</span> <span class="o">=</span> <span class="n">QPixmap</span><span class="p">(</span><span class="s">&quot;../../Images/cavro.jpg&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pixmap</span> <span class="o">=</span> <span class="n">QPixmap</span><span class="p">(</span><span class="s">&quot;../Images/cavro.jpg&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pixmap_item</span> <span class="o">=</span> <span class="n">QGraphicsPixmapItem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pixmap</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span> <span class="o">=</span> <span class="n">QGraphicsScene</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">setBackgroundBrush</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">gray</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pixmap_item</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graphicsView</span><span class="o">.</span><span class="n">setScene</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">closeEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_time</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modified_time</span><span class="p">:</span>
            <span class="n">quit_msg</span> <span class="o">=</span> <span class="s">&quot;The editor script has been modified,</span><span class="se">\n</span><span class="s">Do you still want to continue&quot;</span>
            <span class="n">reply</span> <span class="o">=</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">question</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__appname__</span><span class="p">,</span>\
                    <span class="n">quit_msg</span><span class="p">,</span>\
                    <span class="n">QMessageBox</span><span class="o">.</span><span class="n">Yes</span><span class="p">,</span>\
                    <span class="n">QMessageBox</span><span class="o">.</span><span class="n">No</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">reply</span> <span class="o">==</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">Yes</span><span class="p">:</span>
                <span class="n">event</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">event</span><span class="o">.</span><span class="n">ignore</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">refreshQtimer</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pump</span><span class="o">.</span><span class="n">stop_thread</span><span class="p">()</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="c"># Close open file descriptors</span>
            <span class="k">for</span> <span class="n">a_file</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">open_files</span><span class="p">:</span>
                <span class="n">a_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="k">print</span> <span class="s">&quot;closing {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a_file</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pump</span><span class="o">.</span><span class="n">stop_thread</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">save_btn</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">dir</span> <span class="o">=</span> <span class="s">&quot;.&quot;</span>
        <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">textEdit</span><span class="o">.</span><span class="n">toPlainText</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file_fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">text</span><span class="p">);</span><span class="bp">self</span><span class="o">.</span><span class="n">file_fd</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">saveAs_btn</span><span class="p">()</span>
            
    <span class="k">def</span> <span class="nf">saveAs_btn</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">dir</span> <span class="o">=</span> <span class="s">&quot;.&quot;</span>
        <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">textEdit</span><span class="o">.</span><span class="n">toPlainText</span><span class="p">()</span>
        <span class="n">fileObj</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="o">.</span><span class="n">getSaveFileName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__appname__</span><span class="p">,</span> <span class="nb">dir</span><span class="o">=</span><span class="nb">dir</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="s">&quot;Text Files (*.txt)&quot;</span><span class="p">)</span>
        <span class="n">fileName</span> <span class="o">=</span> <span class="n">fileObj</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file_fd</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&quot;w&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">open_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_fd</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file_fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">text</span><span class="p">);</span><span class="bp">self</span><span class="o">.</span><span class="n">file_fd</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span> <span class="c"># Cancel was pressed</span>
            <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">open_btn</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">dir</span> <span class="o">=</span> <span class="s">&quot;.&quot;</span>
        <span class="n">fileObj</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="o">.</span><span class="n">getOpenFileName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__appname__</span> <span class="o">+</span> <span class="s">&quot; Open File Dialog&quot;</span><span class="p">,</span> <span class="nb">dir</span><span class="o">=</span><span class="nb">dir</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="s">&quot;Text files (*.txt)&quot;</span><span class="p">)</span>
        <span class="n">fileName</span> <span class="o">=</span> <span class="n">fileObj</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">file_fd</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">open_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file_fd</span><span class="p">)</span>
            <span class="n">read</span> <span class="o">=</span> <span class="n">file_fd</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">textEdit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">read</span><span class="p">)</span>
            <span class="n">file_fd</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">update_modify_time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modified_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">run_script</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pump</span><span class="o">.</span><span class="n">exc_mode</span> <span class="o">=</span> <span class="s">&#39;editor&#39;</span>
        <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">textEdit</span><span class="o">.</span><span class="n">toPlainText</span><span class="p">()</span>
        <span class="n">script_commands</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">script_commands</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">!=</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">script_commands</span><span class="p">)</span>
        <span class="n">script_commands</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;pump.change_mode(interactive)&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pump</span><span class="o">.</span><span class="n">update_values</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">script_commands</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">script_commands</span><span class="p">[</span><span class="n">i</span><span class="p">][:</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;pump&#39;</span><span class="p">:</span>
                    <span class="nb">eval</span><span class="p">(</span><span class="s">&quot;self.&quot;</span> <span class="o">+</span> <span class="n">script_commands</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="k">print</span> <span class="s">&quot;self.</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span><span class="n">script_commands</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">script_commands</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;/&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">pump</span><span class="o">.</span><span class="n">send_Command</span><span class="p">(</span><span class="n">script_commands</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> 
                <span class="k">else</span><span class="p">:</span>
                    <span class="c"># TODO The user currently may not issue common python commands yet</span>
                    <span class="nb">eval</span><span class="p">(</span><span class="n">script_commands</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="k">print</span> <span class="n">script_commands</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>


    <span class="k">def</span> <span class="nf">clear_editor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">textEdit</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">init_valve_left</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pump</span><span class="o">.</span><span class="n">initialize_pump</span><span class="p">(</span><span class="n">output</span> <span class="o">=</span> <span class="s">&#39;left&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speed_slider</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">init_valve_right</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pump</span><span class="o">.</span><span class="n">initialize_pump</span><span class="p">(</span><span class="n">output</span> <span class="o">=</span> <span class="s">&#39;right&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speed_slider</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>


    <span class="c"># Qtimer event handling</span>
    <span class="k">def</span> <span class="nf">update_pump_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        First call the refresh method of the reports_window instance</span>
<span class="sd">        which in turn calls the update_values on the pump</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reports_window</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">revert_GUI_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doit</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Function for applying the GUI properties to the pump. </span>

<span class="sd">        The user can call this function to make sure that the status on screen</span>
<span class="sd">        do correspond to the actual pump properties. The function should always</span>
<span class="sd">        be called when the pump was previously running on editor mode and the</span>
<span class="sd">        user switches back to interactive mode.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">doit</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pump</span><span class="o">.</span><span class="n">exc_mode</span> <span class="o">=</span> <span class="s">&#39;interactive&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pump</span><span class="o">.</span><span class="n">exc_mode</span>  <span class="o">==</span> <span class="s">&#39;interactive&#39;</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;Setting the GUI values.</span><span class="se">\n</span><span class="s">doit = {0}</span><span class="se">\n</span><span class="s">exc_mode ={1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">doit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pump</span><span class="o">.</span><span class="n">exc_mode</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">valve_status</span><span class="p">()</span>
            <span class="n">speed_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speed_slider</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pump</span><span class="o">.</span><span class="n">property_set</span><span class="p">(</span><span class="s">&#39;speed&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">speed_val</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pump</span><span class="o">.</span><span class="n">update_values</span><span class="p">()</span>

        
    <span class="k">def</span> <span class="nf">cancel_timer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The purpose of the cancel_timer is to cancel the status refreshing.</span>
<span class="sd">        Can be used by the user to manually update the pump status </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">refreshQtimer</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_status</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">print</span> <span class="s">&quot;TIMER closed&quot;</span>

    <span class="c"># Enabling the volume button</span>
    <span class="k">def</span> <span class="nf">enable_button</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">volume_prompt</span><span class="o">.</span><span class="n">text</span><span class="p">()</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">volume_button</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">volume_button</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>

 
    <span class="c"># Functions for either fulling or emptying the whole syringe</span>
    <span class="k">def</span> <span class="nf">quick_combobox_fun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">quick_combobox</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">quick_action</span> <span class="o">=</span> <span class="s">&#39;push_all&#39;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">quick_combobox</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">quick_action</span> <span class="o">=</span> <span class="s">&#39;pull_all&#39;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">quick_combobox</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">quick_action</span> <span class="o">=</span> <span class="s">&#39;terminate&#39;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">quick_combobox</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">revert_GUI_values</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">make_it_so_function</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">quick_action</span> <span class="o">==</span> <span class="s">&#39;terminate&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pump</span><span class="o">.</span><span class="n">terminate_execution</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">revert_GUI_values</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bypass_btn</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                <span class="n">answer</span> <span class="o">=</span> <span class="s">&quot;Bypass Mode is ON&quot;</span>
                <span class="n">QMessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__appname__</span><span class="p">,</span> <span class="n">answer</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pump</span><span class="o">.</span><span class="n">volume_command</span><span class="p">(</span><span class="n">special</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">quick_action</span><span class="p">)</span>
                <span class="n">label</span> <span class="o">=</span> <span class="s">&quot;Quick Action {action} executed&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">quick_action</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">command_label_show</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>

    <span class="c"># Opening Dialogs</span>
    <span class="k">def</span> <span class="nf">editor_help</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">fd1</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;../text_files/pump_commands_html&#39;</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">fd1</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">open_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fd1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">editor_help_win</span> <span class="o">=</span> <span class="n">AboutDialog</span><span class="p">(</span><span class="n">text</span><span class="p">,</span>\
                <span class="s">&quot;Editor Commands&quot;</span><span class="p">,</span>\
                <span class="n">parent</span> <span class="o">=</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">editor_help_win</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">editor_help_win</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">about_license</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">fd1</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;../text_files/lgpl-2.1.txt&#39;</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">fd1</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">open_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fd1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">about_dialog</span> <span class="o">=</span> <span class="n">AboutDialog</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s">&quot;Software License&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">about_dialog</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">about_software</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">fd1</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;../text_files/about.txt&#39;</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">fd1</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">open_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fd1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">about_soft</span> <span class="o">=</span> <span class="n">AboutDialog2</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s">&quot;About the Software&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">about_soft</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">parameters_change_open</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Opens a ParametersChange Instance.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parameters_window</span> <span class="o">=</span> <span class="n">ParametersChange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pump</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters_window</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters_window</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters_window</span><span class="p">,</span>\
                <span class="n">SIGNAL</span><span class="p">(</span><span class="s">&quot;accepted()&quot;</span><span class="p">),</span>\
                <span class="bp">self</span><span class="o">.</span><span class="n">parameters_window</span><span class="o">.</span><span class="n">update_pump_param</span><span class="p">)</span>



    <span class="k">def</span> <span class="nf">history_window_open</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Opens a HistoryDialog Instance&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">history_window</span> <span class="o">=</span> <span class="n">HistoryDialog</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pump</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">history_window</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">history_window</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">history_window</span><span class="o">.</span><span class="n">refresh_Btn</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">reports_window_open</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Opens a ReportsDialog Instance&quot;&quot;&quot;</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reports_window</span><span class="o">.</span><span class="n">noRefresh</span><span class="p">,</span>\
                <span class="n">SIGNAL</span><span class="p">(</span><span class="s">&quot;clicked()&quot;</span><span class="p">),</span>\
                <span class="bp">self</span><span class="o">.</span><span class="n">reports_window</span><span class="o">.</span><span class="n">tick_refresh</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">reports_window</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reports_window</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reports_window</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span>
   
    <span class="c"># Device Configuration</span>
    <span class="k">def</span> <span class="nf">newDev</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dev_window</span> <span class="o">=</span> <span class="n">NewDevDialog</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pump</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dev_window</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
       
    <span class="k">def</span> <span class="nf">newSyringe</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">syringe_window</span> <span class="o">=</span> <span class="n">SyringePickDialog</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pump</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">syringe_window</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">syringe_window</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">syringe_window</span><span class="p">,</span>\
                <span class="n">SIGNAL</span><span class="p">(</span><span class="s">&quot;accepted()&quot;</span><span class="p">),</span>\
                <span class="bp">self</span><span class="o">.</span><span class="n">syringe_window</span><span class="o">.</span><span class="n">select_new_syringe</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">set_address</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pump</span><span class="o">.</span><span class="n">addr</span> <span class="o">=</span> <span class="s">&#39;/</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">address_combobox</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s">&quot;Addressing to pump #{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pump</span><span class="o">.</span><span class="n">addr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">command_label_show</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
       
    <span class="c"># Valve Status</span>
    <span class="k">def</span> <span class="nf">valve_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Configures the valve of the pump</span>
<span class="sd">        Determines which valve is pressed, </span>
<span class="sd">        sends the command, </span>
<span class="sd">        updates the label &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_btn</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="s">&quot;out&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_btn</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="s">&quot;in&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="s">&quot;bypass&quot;</span>

        <span class="n">answer</span><span class="p">,</span> <span class="n">done</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pump</span><span class="o">.</span><span class="n">valve_command</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">done</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="s">&quot;Valve position changed to {valve_pos}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>\
                    <span class="n">valve_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pump</span><span class="o">.</span><span class="n">own_status</span><span class="p">[</span><span class="s">&quot;valve_pos&quot;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">command_label_show</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prev_valve_btn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">valve_correspond</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prev_valve_btn</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>


    <span class="c"># Plunger speed</span>
    <span class="k">def</span> <span class="nf">speed_control</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Changing the velocity of the plunger</span>

        <span class="n">speed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speed_slider</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pump</span><span class="o">.</span><span class="n">property_set</span><span class="p">(</span><span class="s">&quot;speed&quot;</span><span class="p">,</span> <span class="n">speed</span><span class="p">)</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s">&quot;Plunger Speed Changed: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">speed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">command_label_show</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">lcd_display</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">speed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speed_slider</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lcdNumber</span><span class="o">.</span><span class="n">display</span><span class="p">(</span><span class="n">speed</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">volume_control</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;function for calling the pump.volume_command method.&quot;&quot;&quot;</span>

        <span class="n">volume</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">volume_prompt</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bypass_btn</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="n">answer</span> <span class="o">=</span> <span class="s">&quot;Bypass Mode is ON&quot;</span>
            <span class="n">QMessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__appname__</span><span class="p">,</span> <span class="n">answer</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">PushBtn</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="n">direction</span> <span class="o">=</span> <span class="s">&quot;D&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">PullBtn</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="n">direction</span> <span class="o">=</span> <span class="s">&quot;P&quot;</span>
        <span class="c">#print &quot;volume: {0}\n volume_type: {1}\n direction: {2}: &quot;.format(volume, type(volume), direction)</span>
        <span class="p">(</span><span class="n">done</span><span class="p">,</span> <span class="n">answer</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pump</span><span class="o">.</span><span class="n">volume_command</span><span class="p">(</span><span class="n">direction</span><span class="p">,</span> <span class="n">volume</span><span class="p">)</span>
        <span class="c">#print &quot;done: {0}\n answer: {1}&quot;.format(done, answer)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">done</span><span class="p">:</span>
            <span class="n">QMessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__appname__</span><span class="p">,</span> <span class="n">answer</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">direction</span> <span class="o">==</span> <span class="s">&quot;D&quot;</span><span class="p">:</span>
                <span class="n">label</span> <span class="o">=</span> <span class="s">&quot;Pushed {volume}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">volume</span> <span class="o">=</span> <span class="n">volume</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">label</span> <span class="o">=</span> <span class="s">&quot;Drew {volume}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">volume</span> <span class="o">=</span> <span class="n">volume</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">command_label_show</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">volume_prompt</span><span class="o">.</span><span class="n">selectAll</span><span class="p">()</span>


    <span class="c"># The statusline</span>
    <span class="k">def</span> <span class="nf">command_label_show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a_string</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">command_label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">a_string</span><span class="p">)</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">QApplication</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
    <span class="n">window</span><span class="o">=</span> <span class="n">MainWindow</span><span class="p">()</span>
    <span class="n">window</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="n">app</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span> <span class="c"># Event-loop of the application</span>
</pre></div>
</div>
</div>
<div class="section" id="script-3-classes-used-py">
<h3>Script #3: classes_used.py<a class="headerlink" href="#script-3-classes-used-py" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#  Thu May 29 02:59:41 EEST 2014, nickkouk</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">In this module a set of supplementary classes are set.</span>

<span class="sd">These classes are used primarily for the window_controller functions and assist</span>
<span class="sd">in the UI setup</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c"># proper division for python 2.7</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span>

<span class="c"># Usual importing stuff for PySide</span>
<span class="kn">from</span> <span class="nn">PySide.QtGui</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">PySide.QtCore</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c"># Module imports</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">serial.tools.list_ports</span> <span class="kn">import</span> <span class="n">comports</span>

<span class="c"># Qt-Designer compiled python code</span>
<span class="kn">import</span> <span class="nn">python_gui</span>
<span class="kn">import</span> <span class="nn">python_settings</span>
<span class="kn">import</span> <span class="nn">history_settings</span>
<span class="kn">import</span> <span class="nn">device_configuration</span>
<span class="kn">import</span> <span class="nn">parameters_change</span>
<span class="kn">import</span> <span class="nn">about_dialog</span>
<span class="kn">import</span> <span class="nn">syringe_pick</span>


<span class="k">class</span> <span class="nc">ParametersChange</span><span class="p">(</span><span class="n">QDialog</span><span class="p">,</span> <span class="n">parameters_change</span><span class="o">.</span><span class="n">Ui_Dialog</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is the ParametersChange Class. </span>

<span class="sd">    When an instance of this class is generated the ParametersChange </span>
<span class="sd">    window pops up in the screen</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pump</span><span class="p">,</span> <span class="n">window</span><span class="p">,</span> <span class="n">parent</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ParametersChange</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setupUi</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pump</span> <span class="o">=</span> <span class="n">pump</span>

    <span class="k">def</span> <span class="nf">update_pump_param</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">pairs</span> <span class="o">=</span> <span class="p">[(</span><span class="s">&#39;top_velocity&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Top_Velocity_Edit_2</span><span class="o">.</span><span class="n">text</span><span class="p">()),</span>
                <span class="p">(</span><span class="s">&#39;cutoff_velocity&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cutoff_Velocity_Edit_2</span><span class="o">.</span><span class="n">text</span><span class="p">()),</span>
                <span class="p">(</span><span class="s">&#39;backlash&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Backlash_Steps_Edit_2</span><span class="o">.</span><span class="n">text</span><span class="p">()),</span>
                <span class="p">(</span><span class="s">&#39;start_velocity&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Start_Velocity_Edit_2</span><span class="o">.</span><span class="n">text</span><span class="p">()),</span>
                <span class="p">(</span><span class="s">&#39;slope&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SlopeEdit</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
                <span class="p">]</span>
        
        <span class="n">valid_prs</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">isdigit</span><span class="p">(),</span> <span class="n">pairs</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">valid_prs</span><span class="p">:</span>
            <span class="n">answer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pump</span><span class="o">.</span><span class="n">property_set</span><span class="p">(</span><span class="o">*</span><span class="n">pair</span><span class="p">)</span>
            <span class="k">print</span> <span class="s">&quot;In ParametersChange:</span><span class="se">\n</span><span class="s">asnwer = {0},value = {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">answer</span><span class="p">,</span> <span class="n">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="k">class</span> <span class="nc">HistoryDialog</span><span class="p">(</span><span class="n">QDialog</span><span class="p">,</span> <span class="n">history_settings</span><span class="o">.</span><span class="n">Ui_Dialog</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pump</span><span class="p">,</span> <span class="n">parent</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">HistoryDialog</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setupUi</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> 

        <span class="bp">self</span><span class="o">.</span><span class="n">pump</span> <span class="o">=</span> <span class="n">pump</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__appname__</span> <span class="o">=</span> <span class="s">&quot;Command History&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__appname__</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">refresh_Btn</span><span class="p">,</span>\
                <span class="n">SIGNAL</span><span class="p">(</span><span class="s">&quot;clicked()&quot;</span><span class="p">),</span>\
                <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">commands_only</span><span class="p">,</span>\
                <span class="n">SIGNAL</span><span class="p">(</span><span class="s">&quot;clicked()&quot;</span><span class="p">),</span>\
                <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clear_history_btn</span><span class="p">,</span>\
                <span class="n">SIGNAL</span><span class="p">(</span><span class="s">&quot;clicked()&quot;</span><span class="p">),</span>\
                <span class="bp">self</span><span class="o">.</span><span class="n">clear_history</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user_com_btn</span><span class="p">,</span>\
                <span class="n">SIGNAL</span><span class="p">(</span><span class="s">&quot;clicked()&quot;</span><span class="p">),</span>\
                <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">clear_history</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pump</span><span class="o">.</span><span class="n">history</span> <span class="o">=</span> <span class="p">[</span> <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">refresh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">wanted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pump</span><span class="o">.</span><span class="n">history</span>
        <span class="n">wanted_string</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_com_btn</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="n">wanted</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s">&#39;?&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pump</span><span class="o">.</span><span class="n">history</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">commands_only</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">wanted</span><span class="p">:</span>
                <span class="n">wanted_string</span> <span class="o">+=</span> <span class="s">&quot;{}</span><span class="se">\\</span><span class="s">r</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wanted</span><span class="p">)):</span>
                <span class="n">wanted_string</span> <span class="o">+=</span> <span class="s">&quot;{0}:</span><span class="se">\t</span><span class="s"> {1}</span><span class="se">\\</span><span class="s">r</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">wanted</span><span class="p">[</span><span class="n">i</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">history_edit</span><span class="o">.</span><span class="n">setPlainText</span><span class="p">(</span><span class="n">wanted_string</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">ReportsDialog</span><span class="p">(</span><span class="n">QDialog</span><span class="p">,</span> <span class="n">python_settings</span><span class="o">.</span><span class="n">Ui_Dialog</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pump</span><span class="p">,</span> <span class="n">window</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ReportsDialog</span><span class="p">,</span>  <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setupUi</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__appname__</span> <span class="o">=</span> <span class="s">&quot;Reports Screen&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__appname__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pump</span> <span class="o">=</span> <span class="n">pump</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span> <span class="o">=</span> <span class="n">window</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">refresh_interval_edit</span><span class="p">,</span>\
                <span class="n">SIGNAL</span><span class="p">(</span><span class="s">&quot;textEdited(QString)&quot;</span><span class="p">),</span>\
                <span class="bp">self</span><span class="o">.</span><span class="n">enable_button</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">refresh_now_button</span><span class="p">,</span>\
                <span class="n">SIGNAL</span><span class="p">(</span><span class="s">&quot;clicked()&quot;</span><span class="p">),</span>\
                <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_interval_edit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">&quot;</span>\
                <span class="o">%</span> <span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">refreshQtimer</span><span class="o">.</span><span class="n">interval</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)))</span>

        <span class="c"># Setting the refresh interval manually</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">refresh_interval_button</span><span class="p">,</span>\
                <span class="n">SIGNAL</span><span class="p">(</span><span class="s">&quot;clicked()&quot;</span><span class="p">),</span>\
                <span class="bp">self</span><span class="o">.</span><span class="n">setRefreshTime</span><span class="p">)</span>

    <span class="c"># Enabling the volume button</span>
    <span class="k">def</span> <span class="nf">enable_button</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">refresh_interval_edit</span><span class="o">.</span><span class="n">text</span><span class="p">()</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">refresh_interval_button</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">refresh_interval_button</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">refresh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The refresh function shows the pump major statistics.</span>

<span class="sd">        The refresh function is periodically run using the QTimer refreshQtimer</span>
<span class="sd">        When the timer timeouts the stats are fetched from the pump</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pump</span><span class="o">.</span><span class="n">update_values</span><span class="p">()</span>
        <span class="n">stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pump</span><span class="o">.</span><span class="n">status</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Actual_Position_Edit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="s">&quot;actual_pos&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Backlash_Steps_Edit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="s">&quot;backlash_steps&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Cutoff_Velocity_Edit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="s">&quot;cutoff_vel&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Position_Edit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="s">&quot;absolute_pos&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Start_Velocity_Edit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="s">&quot;starting_vel&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Top_Velocity_Edit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="s">&quot;top_vel&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Checksum_Edit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="s">&quot;checksum&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Fluid_Sensor_Edit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="s">&quot;fluid_sensor&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Buffer_Status_Edit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="s">&quot;buffer_status&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Version_Edit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="s">&quot;version&quot;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">setRefreshTime</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">refresh_interval_edit</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">text</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">refreshQtimer</span><span class="o">.</span><span class="n">setInterval</span><span class="p">(</span>\
                    <span class="nb">eval</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">refresh_interval_edit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">&quot;</span>\
                    <span class="o">%</span> <span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">refreshQtimer</span><span class="o">.</span><span class="n">interval</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)))</span>
            <span class="k">print</span> <span class="s">&quot;Timer interval Set: {} microseconds&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="n">QMessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__appname__</span><span class="p">,</span> <span class="s">&quot;Not a valid input&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_interval_edit</span><span class="o">.</span><span class="n">selectAll</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">tick_refresh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">noRefresh</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">cancel_timer</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">refresh_status</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">setForegroundBrush</span><span class="p">(</span>\
                    <span class="n">QBrush</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">lightGray</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">CrossPattern</span><span class="p">))</span>
           
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">refresh_status</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">refreshQtimer</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">setForegroundBrush</span><span class="p">(</span>\
                    <span class="n">Qt</span><span class="o">.</span><span class="n">NoBrush</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">NewDevDialog</span><span class="p">(</span><span class="n">QDialog</span><span class="p">,</span> <span class="n">device_configuration</span><span class="o">.</span><span class="n">Ui_Dialog</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pump</span><span class="p">,</span> <span class="n">window</span><span class="p">,</span>  <span class="n">parent</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">NewDevDialog</span><span class="p">,</span>  <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setupUi</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__appname__</span> <span class="o">=</span> <span class="s">&quot;Device Configuration&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">buttonBox</span> <span class="o">=</span><span class="n">QDialogButtonBox</span><span class="p">(</span><span class="n">QDialogButtonBox</span><span class="o">.</span><span class="n">Ok</span>
                <span class="o">|</span><span class="n">QDialogButtonBox</span><span class="o">.</span><span class="n">Cancel</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">buttonBox</span><span class="o">.</span><span class="n">accepted</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connect_with_port</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">buttonBox</span><span class="o">.</span><span class="n">rejected</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reject</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">horizontalLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">buttonBox</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__appname__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comports</span> <span class="o">=</span> <span class="n">comports</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pump</span> <span class="o">=</span> <span class="n">pump</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span> <span class="o">=</span> <span class="n">window</span>
        <span class="n">ports_available</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">comports</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">listWidget</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="s">&#39;loop://&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ports_available</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">listWidget</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">ports_available</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">indexes</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;0&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;1&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;2&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s">&quot;3&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s">&quot;4&quot;</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span>\
                <span class="s">&quot;5&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s">&quot;6&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="s">&quot;7&quot;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="s">&quot;8&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="s">&quot;9&quot;</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span> <span class="s">&quot;A&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>\
                <span class="s">&quot;B&quot;</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span> <span class="s">&quot;C&quot;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span> <span class="s">&quot;D&quot;</span><span class="p">:</span> <span class="mi">13</span><span class="p">,</span> <span class="s">&quot;E&quot;</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span> <span class="s">&quot;F&quot;</span><span class="p">:</span> <span class="mi">15</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">connect_with_port</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Passes the selected item into the connect_new method of the pump.&quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">port</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">listWidget</span><span class="o">.</span><span class="n">currentItem</span><span class="p">()</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
            <span class="n">address</span> <span class="o">=</span> <span class="s">&#39;/</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">address_box</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pump</span><span class="o">.</span><span class="n">addr</span> <span class="o">=</span> <span class="n">address</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">address_combobox</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span>\
                    <span class="bp">self</span><span class="o">.</span><span class="n">indexes</span><span class="p">[</span><span class="n">address</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pump</span><span class="o">.</span><span class="n">connect_new</span><span class="p">(</span><span class="n">port</span><span class="p">)</span>
            <span class="n">text</span> <span class="o">=</span> <span class="s">&quot;Port changed to </span><span class="si">%s</span><span class="se">\n</span><span class="s"> Addressing to pump #</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">port</span><span class="p">,</span>\
                    <span class="n">address</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">command_label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="s">&quot;Parameters weren&#39;t set correctly!</span><span class="se">\n</span><span class="s">{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">command_label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">SyringePickDialog</span><span class="p">(</span><span class="n">QDialog</span><span class="p">,</span> <span class="n">syringe_pick</span><span class="o">.</span><span class="n">Ui_Dialog</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pump</span><span class="p">,</span> <span class="n">window</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SyringePickDialog</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setupUi</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__appname__</span> <span class="o">=</span> <span class="s">&quot;Syringe Configuration&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__appname__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pump</span> <span class="o">=</span> <span class="n">pump</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span> <span class="o">=</span> <span class="n">window</span>

        <span class="n">syringe_sizes</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;50 micro&#39;</span><span class="p">,</span> <span class="s">&#39;100 micro&#39;</span><span class="p">,</span> <span class="s">&#39;250 micro&#39;</span><span class="p">,</span> <span class="s">&#39;500 micro&#39;</span><span class="p">,</span> \
                <span class="s">&#39;1000 micro&#39;</span><span class="p">,</span> <span class="s">&#39;5000 micro&#39;</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">syringe_sizes</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">listWidget</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">syringe_sizes</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">select_new_syringe</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Passes the selected item into the connect_new method of the pump.&quot;&quot;&quot;</span>
        <span class="n">syringe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">listWidget</span><span class="o">.</span><span class="n">currentItem</span><span class="p">()</span><span class="o">.</span><span class="n">text</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pump</span><span class="o">.</span><span class="n">syringe_size</span> <span class="o">=</span> <span class="n">syringe</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s">&quot;Syringe size is set to {size}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pump</span><span class="o">.</span><span class="n">syringe_size</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">command_label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pump</span><span class="o">.</span><span class="n">update_values</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">AboutDialog</span><span class="p">(</span><span class="n">QDialog</span><span class="p">,</span> <span class="n">about_dialog</span><span class="o">.</span><span class="n">Ui_Form</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">appname</span><span class="p">,</span> <span class="n">parent</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">AboutDialog</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setupUi</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__appname__</span> <span class="o">=</span> <span class="n">appname</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__appname__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setFixedSize</span><span class="p">(</span><span class="mi">800</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">text</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_text</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">load_text</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">textBrowser</span><span class="o">.</span><span class="n">setHtml</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">AboutDialog2</span><span class="p">(</span><span class="n">QDialog</span><span class="p">,</span> <span class="n">about_dialog</span><span class="o">.</span><span class="n">Ui_Form</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">appname</span><span class="p">,</span> <span class="n">parent</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">AboutDialog2</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setupUi</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__appname__</span> <span class="o">=</span> <span class="n">appname</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__appname__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">text</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_text</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">QtButton</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s">&quot;About Qt&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">horizontalLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">QtButton</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">QtButton</span><span class="p">,</span>\
                <span class="n">SIGNAL</span><span class="p">(</span><span class="s">&quot;clicked()&quot;</span><span class="p">),</span>\
                <span class="bp">self</span><span class="o">.</span><span class="n">about_qt</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">load_text</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">textBrowser</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">about_qt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">QMessageBox</span><span class="o">.</span><span class="n">aboutQt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s">&quot;About Qt&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Code Walkthrough</a><ul>
<li><a class="reference internal" href="#full-python-code">Full Python Code</a><ul>
<li><a class="reference internal" href="#script-1-pump-model-py">Script #1: pump_model.py</a></li>
<li><a class="reference internal" href="#script-2-pump3000-py">Script #2: Pump3000.py</a></li>
<li><a class="reference internal" href="#script-3-classes-used-py">Script #3: classes_used.py</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="pump-commands.html"
                        title="previous chapter">Pump Commands</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="license.html"
                        title="next chapter">License</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/code-walkthrough.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="license.html" title="License"
             >next</a> |</li>
        <li class="right" >
          <a href="pump-commands.html" title="Pump Commands"
             >previous</a> |</li>
        <li><a href="index.html">Cavro XP3000 GUI 1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, Nikos Koukis.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>